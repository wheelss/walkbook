<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xiekai.demo.rotation.dao.RotationDao">

    <!--新增轮播图-->
    <insert id="saveRotation" parameterType="com.xiekai.demo.rotation.entity.RotationInfo">
        insert into rotation
        (rotation,
        sorting,
        status,
        effective_date,
        expiry_date,
        good,
        is_delete,
        create_user,
        create_time,
        update_user,
        update_time,
        version)
        values
        (#{rotation},
        #{sorting},
        2,
        #{effectiveDate},
        #{expiryDate},
        #{good},
        0,
        #{createUser},
        now(),
        #{updateUser},
        now(),
        0)
    </insert>

    <!--删除轮播图-->
    <update id="deleteRotation" parameterType="com.xiekai.demo.rotation.entity.RotationInfo">
        update rotation
        set
        is_delete = 1,
        update_time = now(),
        update_user = #{updateUser},
        version = version + 1
        where rotation_id in
        <foreach item="item" index="index" collection="listCode" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>

    <!--修改轮播图状态-->
    <update id="updateRotationStatus" parameterType="com.xiekai.demo.rotation.entity.RotationInfo">
        update rotation
        set
        status = #{status},
        update_time = now(),
        update_user = #{updateUser},
        effective_date =now(),
        expiry_date = #{expiryDate},
        version = version + 1
        where rotation_id in
        <foreach item="item" index="index" collection="listCode" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>

    <!--轮播图列表-->
    <select id="listRotationByPage" parameterType="com.xiekai.demo.rotation.entity.RotationInfo"
            resultType="com.xiekai.demo.rotation.entity.RotationInfo">
        select
            sorting,
            rotation,
            status,
            effective_date,
            expiry_date
        from rotation
        where is_delete = 0
        <if test="status != null and status != ''">
            and status like concat('%', #{status}, '%')
        </if>
        order by update_time desc
    </select>

    <!--商品列表-->
    <select id="listGoodByPage" parameterType="com.xiekai.demo.good.entity.GoodInfo"
            resultType="com.xiekai.demo.good.entity.GoodInfo">
        select
            isbn_code isbnCode,
            good_name goodName,
            sales,
            first_classification firstClassification,
            second_classification secondClassification
        from good
        where is_delete = 0
        <if test="goodName != null and goodName != ''">
            and good_name like concat('%', #{goodName}, '%')
        </if>
        <if test="isbnCode != null and isbnCode != ''">
            and isbn_code like concat('%', #{isbnCode}, '%')
        </if>
        order by update_time desc
    </select>

</mapper>